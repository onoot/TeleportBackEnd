# Call Service

Сервис для управления видеозвонками в мессенджере. Обеспечивает функциональность создания и управления видеозвонками между пользователями.

## Функциональность

- Создание комнат для видеозвонков
- Управление участниками звонка (присоединение/отключение)
- Обмен WebRTC сигналами между участниками
- Управление аудио/видео потоками
- Отслеживание состояния участников
- Интеграция с Kafka для событий
- Кэширование данных в Redis

## Технологии

- Node.js
- NestJS
- Socket.IO
- Redis
- Kafka
- WebRTC

## Установка

1. Установите зависимости:
```bash
npm install
```

2. Создайте файл .env на основе .env.example и настройте переменные окружения.

3. Запустите сервис:
```bash
# Режим разработки
npm run dev

# Продакшн
npm run build
npm start
```

## WebSocket События

### Клиент -> Сервер

- `join_call` - Присоединиться к звонку
- `leave_call` - Покинуть звонок
- `signal` - Отправка WebRTC сигнала
- `mute_audio` - Включить/выключить аудио
- `mute_video` - Включить/выключить видео

### Сервер -> Клиент

- `call_joined` - Успешное присоединение к звонку
- `participant_joined` - Новый участник присоединился
- `participant_left` - Участник покинул звонок
- `signal` - Получение WebRTC сигнала
- `participant_audio_changed` - Изменение состояния аудио
- `participant_video_changed` - Изменение состояния видео
- `error` - Ошибка

## Kafka События

- `call.created` - Создан новый звонок
- `call.ended` - Звонок завершен
- `call.participant.joined` - Участник присоединился
- `call.participant.left` - Участник покинул звонок

## Redis

Используется для:
- Хранения информации о комнатах
- Отслеживания активных участников
- Кэширования состояния звонков

## Примеры использования

```typescript
// Подключение к звонку
socket.emit('join_call', 'room-id');

// Отправка WebRTC сигнала
socket.emit('signal', {
  type: 'offer',
  payload: /* SDP */,
  targetUserId: 123
});

// Управление медиа
socket.emit('mute_audio', true);
socket.emit('mute_video', false);
``` 